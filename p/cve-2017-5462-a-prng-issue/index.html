<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='On April 19, 2017, Mozilla Foundation published the Security Advisory 2017-10 outlining several recently fixed security vulnerabilities. One of these vulnerabilities, tracked as CVE-2017-5462, affects the Pseudo-Random Number Generator (PRNG) within the Network Security Services (NSS) library prior to version 3.29.5 and Firefox prior to version 53.
This post describes the bug and how it was discovered.
Inside the NSS PRNG NSS uses Hash_DRBG as PRNG, which is one of several PRNG schemes defined in the NIST Special Publication 800-90.'><title>CVE-2017-5462 - A PRNG issue</title>

<link rel='canonical' href='https://www.franziskuskiefer.de/p/cve-2017-5462-a-prng-issue/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='CVE-2017-5462 - A PRNG issue'>
<meta property='og:description' content='On April 19, 2017, Mozilla Foundation published the Security Advisory 2017-10 outlining several recently fixed security vulnerabilities. One of these vulnerabilities, tracked as CVE-2017-5462, affects the Pseudo-Random Number Generator (PRNG) within the Network Security Services (NSS) library prior to version 3.29.5 and Firefox prior to version 53.
This post describes the bug and how it was discovered.
Inside the NSS PRNG NSS uses Hash_DRBG as PRNG, which is one of several PRNG schemes defined in the NIST Special Publication 800-90.'>
<meta property='og:url' content='https://www.franziskuskiefer.de/p/cve-2017-5462-a-prng-issue/'>
<meta property='og:site_name' content='Dr Franziskus Kiefer'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='prng' /><meta property='article:tag' content='NSS' /><meta property='article:tag' content='crypto' /><meta property='article:published_time' content='2017-08-31T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2017-08-31T00:00:00&#43;00:00'/><meta property='og:image' content='https://www.franziskuskiefer.de/p/cve-2017-5462-a-prng-issue/hero.jpg' />
<meta name="twitter:site" content="@_franziskus_">
    <meta name="twitter:creator" content="@_franziskus_"><meta name="twitter:title" content="CVE-2017-5462 - A PRNG issue">
<meta name="twitter:description" content="On April 19, 2017, Mozilla Foundation published the Security Advisory 2017-10 outlining several recently fixed security vulnerabilities. One of these vulnerabilities, tracked as CVE-2017-5462, affects the Pseudo-Random Number Generator (PRNG) within the Network Security Services (NSS) library prior to version 3.29.5 and Firefox prior to version 53.
This post describes the bug and how it was discovered.
Inside the NSS PRNG NSS uses Hash_DRBG as PRNG, which is one of several PRNG schemes defined in the NIST Special Publication 800-90."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://www.franziskuskiefer.de/p/cve-2017-5462-a-prng-issue/hero.jpg' />
    </head>
    <body class="
    article-page 
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        on-phone--column extended
    
">
    
        <aside class="sidebar left-sidebar sticky">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header class="site-info">
        
            
            <figure class="site-avatar">
                
                    
                    
                    
                        
                        <img src="/images/profilepic_hu3bc014a75079c34bb907fbf6d5a69568_649030_300x0_resize_q75_box.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                

                
            </figure>
            
        
        <h1 class="site-name"><a href="https://www.franziskuskiefer.de/">Dr Franziskus Kiefer</a></h1>
        <h2 class="site-description">Cryptography &amp; Security Engineer and Researcher based in Berlin</h2>
    </header>

    <ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/about/' >
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        

        <li >
            <a href='/publications/' >
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11 3L20 12a1.5 1.5 0 0 1 0 2L14 20a1.5 1.5 0 0 1 -2 0L3 11v-4a4 4 0 0 1 4 -4h4" />
  <circle cx="9" cy="9" r="2" />
</svg>



                
                <span>Publications</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        

        <li >
            <a href='https://github.com/franziskuskiefer/' target="_blank">
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>
                
                <span>Github</span>
            </a>
        </li>
        
        

        <li >
            <a href='https://twitter.com/_franziskus_' target="_blank">
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>
                
                <span>Twitter</span>
            </a>
        </li>
        

        
            <li id="dark-mode-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <span>Dark Mode</span>
            </li>
        
    </ol>
</aside>

    
<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/cve-2017-5462-a-prng-issue/">
                <img src="/p/cve-2017-5462-a-prng-issue/hero_hu3d03a01dcc18bc5be0e67db3d8d209a6_1186302_800x0_resize_q75_box.jpg"
                        srcset="/p/cve-2017-5462-a-prng-issue/hero_hu3d03a01dcc18bc5be0e67db3d8d209a6_1186302_800x0_resize_q75_box.jpg 800w, /p/cve-2017-5462-a-prng-issue/hero_hu3d03a01dcc18bc5be0e67db3d8d209a6_1186302_1600x0_resize_q75_box.jpg 1600w"
                        width="800" 
                        height="1067" 
                        loading="lazy"
                        alt="Featured image of post CVE-2017-5462 - A PRNG issue" />
                
            </a>
        </div>
    

    <div class="article-details">
    

    <h2 class="article-title">
        <a href="/p/cve-2017-5462-a-prng-issue/">CVE-2017-5462 - A PRNG issue</a>
    </h2>

    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Aug 31, 2017</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    6 min read
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <p>On April 19, 2017, Mozilla Foundation published the <a class="link" href="https://www.mozilla.org/en-US/security/advisories/mfsa2017-10/%5c#CVE-2017-5462"  target="_blank" rel="noopener"
    >Security Advisory 2017-10</a> outlining several recently fixed security vulnerabilities.
One of these vulnerabilities, tracked as CVE-2017-5462, affects the Pseudo-Random Number Generator (PRNG) within the Network Security Services (NSS) library prior to version 3.29.5 and Firefox prior to version 53.</p>
<p>This post describes the bug and how it was discovered.</p>
<h1 id="inside-the-nss-prng">Inside the NSS PRNG</h1>
<p>NSS uses <code>Hash_DRBG</code> as PRNG, which is one of several PRNG schemes defined in the <a class="link" href="http://csrc.nist.gov/publications/nistpubs/"  target="_blank" rel="noopener"
    >NIST Special Publication 800-90</a>.
Like most widely used PRNGs the <code>Hash_DRBG</code> is a Deterministic Random Bit Generator (DRBG). (Even though this term is usually only used for NIST PRNGs.)
While the standard contains all the details, the relevant features can be summarised as follows.</p>
<p>The state of <code>Hash_DRBG</code> is composed of three values:</p>
<ul>
<li>A 55-byte integer state variable <code>V</code>, which is updated with each
request of new bits</li>
<li>A 55-byte integer constant <code>C</code> that depends on the seed and is updated when re-seeding the PRNG.</li>
<li>A counter <code>c</code> tracking when the next re-seeding is needed.</li>
</ul>
<p>To generate random bits, <code>Hash_DRBG</code> concatenates <code>H(V) || H(V+1) || H(V+2) || ...</code> until enough bits are generated.
<code>H</code> denotes a cryptographic hash function here.
NSS uses the SHA-256 hash function for <code>H</code> with a digest length of 32 bytes.
After generating new bits the state variable <code>V</code> is updated according to the rule <code>V</code><sub><code>c+1</code></sub> <code> = V + H(0x03 || V</code><sub><code>c</code></sub> <code>) + C + c</code> and counter <code>c</code> is incremented by one.
Addition is performed modulo <code>2</code><sup><code>440</code></sup> <code> = 2</code><sup><code>8*55</code></sup> to fit it in the 55 bytes of <code>V</code>.</p>
<p>The PRNG implementation can be found in the file <a class="link" href="https://searchfox.org/nss/rev/fcdcad1fc1ddb6e70653637b0ea0f3359b8533f2/lib/freebl/drbg.c"  target="_blank" rel="noopener"
    >drbg.c</a> within the NSS codebase.</p>
<h1 id="cve-2017-5462">CVE-2017-5462</h1>
<p>The issue identified in CVE-2017-5462 is in the code implementing the addition.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> * build some fast inline functions for adding.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="cp">#define PRNG_ADD_CARRY_ONLY(dest, start, carry)    \
</span></span></span><span class="line"><span class="cl"><span class="cp">    {                                              \
</span></span></span><span class="line"><span class="cl"><span class="cp">        int k1;                                    \
</span></span></span><span class="line"><span class="cl"><span class="cp">        for (k1 = start; carry &amp;&amp; k1 &gt;= 0; k1--) { \
</span></span></span><span class="line"><span class="cl"><span class="cp">            carry = !(++dest[k1]);                 \
</span></span></span><span class="line"><span class="cl"><span class="cp">        }                                          \
</span></span></span><span class="line"><span class="cl"><span class="cp">    }
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> * NOTE: dest must be an array for the following to work.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="cp">#define PRNG_ADD_BITS(dest, dest_len, add, len, carry)               \
</span></span></span><span class="line"><span class="cl"><span class="cp">    carry = 0;                                                       \
</span></span></span><span class="line"><span class="cl"><span class="cp">    PORT_Assert((dest_len) &gt;= (len));                                \
</span></span></span><span class="line"><span class="cl"><span class="cp">    {                                                                \
</span></span></span><span class="line"><span class="cl"><span class="cp">        int k1, k2;                                                  \
</span></span></span><span class="line"><span class="cl"><span class="cp">        for (k1 = dest_len - 1, k2 = len - 1; k2 &gt;= 0; --k1, --k2) { \
</span></span></span><span class="line"><span class="cl"><span class="cp">            carry += dest[k1] + add[k2];                             \
</span></span></span><span class="line"><span class="cl"><span class="cp">            dest[k1] = (PRUint8)carry;                               \
</span></span></span><span class="line"><span class="cl"><span class="cp">            carry &gt;&gt;= 8;                                             \
</span></span></span><span class="line"><span class="cl"><span class="cp">        }                                                            \
</span></span></span><span class="line"><span class="cl"><span class="cp">    }
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define PRNG_ADD_BITS_AND_CARRY(dest, dest_len, add, len, carry) \
</span></span></span><span class="line"><span class="cl"><span class="cp">    PRNG_ADD_BITS(dest, dest_len, add, len, carry)               \
</span></span></span><span class="line"><span class="cl"><span class="cp">    PRNG_ADD_CARRY_ONLY(dest, dest_len - len, carry)
</span></span></span></code></pre></div><p>When the PRNG performs addition to update <code>V</code> it uses the macro <code>PRNG_ADD_BITS_AND_CARRY</code>, which first delegates to the macro <code>PRNG_ADD_BITS</code> to add the two summands without considering the final carry and then the macro <code>PRNG_ADD_CARRY_ONLY</code> to add the carry.</p>
<p>In this addition code it is clear that the carry should be added at the position <em>preceding</em> the original most-significant-byte of the shorter of the two summands.
This fact was supposed to be represented by the index <code>dest_len-len</code> supplied as parameter to <code>PRNG_ADD_CARRY_ONLY</code>.
Note that numbers are represented as sequences of bytes with byte number zero being the most-significant byte.
The essence of the bug is that <code>dest_len-len</code> does not point to the correct position of the carry, which should have been added at position <code>dest_len-len-1</code> instead.</p>
<p><figure style="flex-grow: 272; flex-basis: 653px">
		<a href="/p/cve-2017-5462-a-prng-issue/CVE-2017-5462-bug.png" data-size="822x302"><img src="/p/cve-2017-5462-a-prng-issue/CVE-2017-5462-bug.png"
				srcset="/p/cve-2017-5462-a-prng-issue/CVE-2017-5462-bug_hub1c2623f6de8a86dd08abf8f9dad51d9_19637_480x0_resize_box_3.png 480w, /p/cve-2017-5462-a-prng-issue/CVE-2017-5462-bug_hub1c2623f6de8a86dd08abf8f9dad51d9_19637_1024x0_resize_box_3.png 1024w"
				width="822"
				height="302"
				loading="lazy"
				>
		</a>
		
	</figure></p>
<h2 id="example">Example</h2>
<p>We note that <code>3 * 0x40 = 0xc0</code> under both proper and broken addition (the latter due to absence of carrying in this example).
However, <code>3 * 0x95 = 0x01bf</code> under proper unbounded addition resp. <code>0xbf</code> under proper modulo addition.
Yet, the result under broken addition is <code>0x01 + 0xbf = 0xc0</code>.</p>
<h1 id="finding-the-bug-with-testing">Finding the Bug with Testing</h1>
<p>The easiest way to find most types of bugs in PRNGs following NIST SP 800-90 is by testing the implementation with the official test vectors (seeds and outputs) provided in the standard.
I found the bug after implementing these test vectors.
Functional unit testing would probably have caught this particular bug as well.
For PRNGs not following the NIST standard, defining corresponding test vectors is a good idea to avoid regressions during maintenance.</p>
<p>Statistical tests such as NIST SP 800-22 or <a class="link" href="https://github.com/ticki/diehardest"  target="_blank" rel="noopener"
    >DIEHARDEST</a> are not very useful for testing cryptographic PRNGs.
They can be used for testing the entropy pool that is fed into the PRNG.
But such tests will not fail as long as the internal state does not stay constant and output passes through a cryptographic primitive (such as SHA-256) before reaching the consumer.</p>
<h1 id="formal-analysis">Formal Analysis</h1>
<p>Independ of my investigation, <a class="link" href="https://formal.iti.kit.edu/klebanov/"  target="_blank" rel="noopener"
    >Vladimir Klebanov</a> found this bug using <a class="link" href="https://formal.iti.kit.edu/~klebanov/software/entroposcope/"  target="_blank" rel="noopener"
    >Entroposcope</a>, a static analysis tool created for finding implementation bugs in pseudo-random number generators.</p>
<p>Entropy loss occurs when the number of possible output streams is less than the number of possible seeds.
This is equivalent to the case when two different seeds produce the same output stream (also called a collision).
Entroposcope is built on top of the bounded model checker <a class="link" href="https://link.springer.com/chapter/10.1007/978-3-642-54862-8_26"  target="_blank" rel="noopener"
    >CBMC</a>, which in turn transforms the problem into a challenge for a <a class="link" href="https://en.wikipedia.org/wiki/Boolean_satisfiability_problem"  target="_blank" rel="noopener"
    >SAT solver</a>.</p>
<p>Considering the <code>Hash_DRBG</code>, the question whether <code>V</code><sub><code>c+1</code></sub> <code> = V + H(0x03 || V</code><sub><code>c</code></sub> <code>) + C + c</code> produces a collision and the DRBG loses entropy or not boils down to whether distinct 55-byte values <code>x</code><sub><code>1</code></sub>, <code>x</code><sub><code>2</code></sub> exist, such that <code>x</code><sub><code>1</code></sub> <code> + H(x</code><sub><code>1</code></sub><code>) = x</code><sub><code>2</code></sub> <code> + H(x</code><sub><code>2</code></sub><code>)</code>.
Now, it is clear that this question cannot be answered without either knowing the output of <code>H</code> for each 55-byte input (which is infeasible) or some (unknown to us and certainly also to the tool) nontrivial mathematical argument on the nature of <code>H</code> in this context.
In this regard, the <code>Hash_DRBG</code> differs from many other PRNGs that employ significantly simpler operations on the output of <code>H</code> before it makes its way to the PRNG caller.</p>
<p>As a consequence of this design, Entroposcope can not be used to prove absence of entropy loss in the <code>Hash_DRBG</code>.
Nonetheless, Entroposcope can check collision-freedom of the PRNG under an idealised <code>H</code> and find bugs in the parts of the implementation that are not <code>H</code>.
For this purpose we consider an idealised PRNG with <code>H(b||V) = V</code> and <code>C = V</code><sub><code>0</code></sub>.
This is the same kind of idealisation that helped Vladimir to uncover previously unknown bugs in OpenSSL and <a class="link" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-6313"  target="_blank" rel="noopener"
    >GnuPG</a>.
With the idealisation, on the first iteration (<code>c = 0</code>) updating the state becomes <code>V</code><sub><code>1</code></sub> <code> = 3 * V</code><sub><code>0</code></sub>.
Because <code>3</code> and <code>2</code><sup><code>440</code></sup> are co-prime, <code>V</code><sub><code>1</code></sub> will not produce a collision if implemented properly.</p>
<p>Indeed, given the idealised code, Entroposcope produced a counterexample to entropy preservation with two concrete seeds leading to the same output stream.
Tracing these two executions makes it easy to pinpoint the cause of the collision in the addition code.</p>
<p>Thanks to Vladimir for finding this bug and helping to write this post.</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/prng/">prng</a>
        
            <a href="/tags/nss/">NSS</a>
        
            <a href="/tags/crypto/">crypto</a>
        
    </section>


    </footer>


    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="has-image">
    <a href="/p/aes-gcm-speedup/">
        
        
            <div class="article-image">
                <img src="/p/aes-gcm-speedup/linux64-encrypt.bab7615064ddee49ff4eec93c30bab4c_huda4d54ffc045a6df2c10e7f1ccf14ff2_16323_250x150_fill_box_smart1_3.png" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="" 
                        data-hash="md5-urdhUGTd7kn/TuyTwwurTA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Aes Gcm Speedup</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/p/on-constant-time-division/">
        
        
            <div class="article-image">
                <img src="/p/on-constant-time-division/plot_low-1.f4a0788c9f7fdf9073cae01a07d35207_huce53492d5f2ce19360b675e9dc98bbf5_27543_250x150_fill_box_smart1_3.png" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="" 
                        data-hash="md5-9KB4jJ9/35BzyuAaB9NSBw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">On Constant Time Division</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
     
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2013 - 
        
        2022 Dr Franziskus Kiefer
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.1.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
