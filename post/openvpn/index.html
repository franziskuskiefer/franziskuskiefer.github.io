<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
     
    <title>FK  | OpenVPN HowTo</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
     <meta name="generator" content="Hugo 0.55.6" />
      
      
        <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
      

     <link href='https://www.franziskuskiefer.de/dist/main.css' rel='stylesheet' type="text/css" />

     

      <meta property="og:title" content="OpenVPN HowTo" />
<meta property="og:description" content="OpenPVN is an easy to set-up and use VPN solution that offer TUN/TAP support. In this tutorial I describe how to set-up an OpenVPN connection between a Ubuntu server and an Arch client.
Preparations (Server) First we have to install OpenVPN on the server.
# apt-get install openvpn To see whether TUN/TAP is enabled in the kernel we can check the kernel log grep tun /var/log/kern.log and load it if it doesn&rsquo;t show up modprobe tun." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.franziskuskiefer.de/post/openvpn/" />
<meta property="article:published_time" content="2014-10-12T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2014-10-12T00:00:00&#43;00:00"/>

<meta itemprop="name" content="OpenVPN HowTo">
<meta itemprop="description" content="OpenPVN is an easy to set-up and use VPN solution that offer TUN/TAP support. In this tutorial I describe how to set-up an OpenVPN connection between a Ubuntu server and an Arch client.
Preparations (Server) First we have to install OpenVPN on the server.
# apt-get install openvpn To see whether TUN/TAP is enabled in the kernel we can check the kernel log grep tun /var/log/kern.log and load it if it doesn&rsquo;t show up modprobe tun.">


<meta itemprop="datePublished" content="2014-10-12T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2014-10-12T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="413">



<meta itemprop="keywords" content="linux,openvpn," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="OpenVPN HowTo"/>
<meta name="twitter:description" content="OpenPVN is an easy to set-up and use VPN solution that offer TUN/TAP support. In this tutorial I describe how to set-up an OpenVPN connection between a Ubuntu server and an Arch client.
Preparations (Server) First we have to install OpenVPN on the server.
# apt-get install openvpn To see whether TUN/TAP is enabled in the kernel we can check the kernel log grep tun /var/log/kern.log and load it if it doesn&rsquo;t show up modprobe tun."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://www.franziskuskiefer.de/" class="f3 fw2 hover-white no-underline white-90 dib">
      FK
    </a>
    <div class="flex-l items-center">
      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/about/" title="About page">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/post/" title="Articles page">
              Articles
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/publications/" title="Publications page">
              Publications
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/resume/" title="Resume page">
              Resume
            </a>
          </li>
          
        </ul>
      
      



  <a href="https://twitter.com/_franziskus_" class="link-transition twitter link dib z-999 pt3 pt0-l mr2" title="Twitter link">
    <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

  </a>




    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  <div class="flex-l mt2 mw8 center">
    <article class="center cf pv5 ph3 ph4-ns mw7">
      <p class="f6 b helvetica tracked">
        
        POST
      </p>
      <h1 class="f1 athelas">
        OpenVPN HowTo
      </h1>
        
        
      <time class="f6 mv4 dib tracked" datetime="2014-10-12T00:00:00Z">
        October 12, 2014
      </time>
      <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray">
        

<p><a href="https://openvpn.net">OpenPVN</a> is an easy to set-up and use VPN solution that offer <a href="https://en.wikipedia.org/wiki/TUN/TAP">TUN/TAP</a> support. In this tutorial I describe how to set-up an OpenVPN connection between a Ubuntu server and an Arch client.</p>

<h1 id="preparations-server">Preparations (Server)</h1>

<p>First we have to install OpenVPN on the server.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># apt-get install openvpn</span></code></pre></div>
<p>To see whether TUN/TAP is enabled in the kernel we can check the kernel log <code>grep tun /var/log/kern.log</code> and load it if it doesn&rsquo;t show up <code>modprobe tun</code>.</p>

<h2 id="creating-a-pki">Creating a PKI</h2>

<p>To use OpenVPN we need a PKI and certificates. Fortunately there is a script for that.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># apt-get install easy-rsa</span></code></pre></div>
<p>First we create a folder to store our certificates in <code>mkdir easy-rsa</code> and get the default variables file <code>cp /usr/share/easy-rsa/vars easy-rsa</code>. The file is prefilled but one may want to change</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C">    KEY_COUNTRY
    KEY_PROVINCE
    KEY_CITY
    KEY_ORG
    KEY_EMAIL
    KEY_OU</code></pre></div>
<p>All other standard parameteres should usually be fine but can be changed if desired. Now we change to <code>/usr/share/easy-rsa</code> and load the variables <code># source &lt;PATH_TO_VARS&gt;/vars</code> and run <code>./build-ca</code>. If there have been keys before one should run <code>./clean-all</code> first.</p>

<p>Now we can start creating keys and sign them. First we create the server key with</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># ./build-key-server my-test-server</span></code></pre></div>
<p>and aswer with <code>yes</code> two times. We do the same for a client key</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># ./build-key my-test-client</span></code></pre></div>
<p>To build Diffie-Hellman parameters we run <code>./build-dh</code> <em>(this can take some time)</em>. Eventually we create an HMAC key for our VPN and store it with the other keys</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># openvpn --genkey --secret /usr/share/easy-rsa/keys/ta.key</span></code></pre></div>
<h1 id="configuring-openvpn-server">Configuring OpenVPN (Server)</h1>

<p>Everything is set-up now to configure and run the OpenVPN server. First we copy the sample configuration file to the correct folder</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># cp /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz /etc/openvpn/</span>
<span style="color:#75715e"># gzip -d /etc/openvpn/server.conf.gz</span></code></pre></div>
<p>At least the following changes to <code>server.conf</code> should be made after copying keys, parameters and certificates.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ca /etc/openvpn/ca.crt
cert /etc/openvpn/my-test-server.crt
key /etc/openvpn/my-test-server.key
dh /etc/openvpn/dh2048.pem
tls-auth /etc/openvpn/ta.key <span style="color:#ae81ff">0</span>
user nobody
group nobody</code></pre></div>
<h1 id="starting-openvpn-server">Starting OpenVPN (Server)</h1>

<p>The server can now be started with</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">openvpn /etc/openvpn/server.conf</code></pre></div>
<h1 id="configuring-openvpn-client">Configuring OpenVPN (Client)</h1>

<p>First we have to get key, certificate and parameters from the server to the client. Now we install OpenVPN on the client <code>pacman -S openpvpn</code> copy the sample-configuration file somewhere nice <code># cp /usr/share/openvpn/examples/client.conf /etc/openvpn/client.conf</code> and modify at least the following</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">remote test-server-ip <span style="color:#ae81ff">1194</span>
ca /etc/openvpn/ca.crt
cert /etc/openvpn/my-test-client.crt
key /etc/openvpn/my-test-client.key
dh /etc/openvpn/dh2048.pem
tls-auth /etc/openvpn/ta.key <span style="color:#ae81ff">1</span>
user nobody
group nobody</code></pre></div>
<p>The <em>test-server-ip</em> has to be replaced with the server&rsquo;s IP or URL. Now we can also start the client <code># openvpn /etc/openvpn/client.conf</code>. The start-up should end with</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Initialization Sequence Completed</code></pre></div>
      </section>
      

  
  
  
  
  


    </article>
  </div>

    </main>
    <footer class="bg-near-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://www.franziskuskiefer.de/" >
    &copy; 2019 FK
  </a>
  



  <a href="https://twitter.com/_franziskus_" class="link-transition twitter link dib z-999 pt3 pt0-l mr2" title="Twitter link">
    <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

  </a>




  </div>
</footer>

    <script src="https://www.franziskuskiefer.de/dist/app.bundle.js" async></script>

  </body>
</html>
